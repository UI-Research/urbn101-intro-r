---
title: "Day 2: data management"
author: "Sarah Strochak (HFPC)"
date: "`r format(Sys.time(), '%B %d, %Y %H:%M')`"
output:
  html_document:
    number_sections: TRUE
    self_contained: TRUE
    code_folding: hide
    toc: TRUE
    toc_float: TRUE
    css: ../www/web_report.css
    editor_options:
      chunk_output_type: console
---


# Review

* assignment operator
* functions

# Motivation 

"The toughest part of data visualization is data munging."
- Aaron Williams

# Primary functions

* `select()`
* `rename()`
* `filter()`
* `arrange()`
* `mutate()`
* `summarize()`
* `group_by()`

# The pipe operator

`%>%`

The pipe operator allows you to string together a set of different functions.
Functionally, the first argument in the next function you are using will be replaced with what precedes `%>%`

# Exercise 0

If you are using a different computer or didn't attend last Friday's session, follow steps 1 and 2. If not- skip to step 3.

<font color="#55b748">**Step 1:**</font> Create a new directory called `urbn101`

<font color="#55b748">**Step 2:**</font> Open RStudio. Click "Project: (None)" in the top right corner. Click "New Project" and create a project based on the existing `urbn101` directory.

<font color="#55b748">**Step 3:**</font> Open a `.R` script with the button in the top left. Save the script as `02_data-management.R`.

<font color="#55b748">**Step 4:**</font> If you have not previously installed `library(tidyverse)`: submit `install.packages("tidyverse")` to the Console.

<font color="#55b748">**Step 5:**</font> Write `library(tidyverse)` at the top of `02_data-management.R`. With the cursor on the line of text, click Control-Enter.

# Exercise 1
<font color="#55b748">**Step 1:**</font> Assign the `diamonds` dataset to be called diamonds. Submit `View(diamonds)` in the console.

<font color="#55b748">**Step 2:**</font> Create a new dataset with all the variables except for `x`, `y`, `z`, by using `select` and `-`.

<font color="#55b748">**Step 3:**</font> Create a new dataset that includes only premium diamonds using `filter()`

<font color="#55b748">**Step 4:**</font> Chain all three of these commands together with the `%>%` operator.

<font color="#ec008b">**Filter and select**</font>

`select()` is used when you want to limit the number of **columns** in your data set. `filter()` is used when you want to limit the number observations in your dataset, bsaed on certain criteria.
<font color="#ec008b">Rename</font>

The syntax for rename is:
```
dataset %>% 
  rename(new_name = current_name)
```
This same syntax can be used inside `select()`, and you can rename and select variable simultanously.

# Exercise 2 

<font color="#55b748">**Step 1:**</font> Use the `txhousing` dataset. Assign the dataset to an abject.

<font color="#55b748">**Step 2:**</font> Compute a new variable, `average_price` by dividing `volume` by `sales`.

<font color="#55b748">**Step 3:**</font> Use `ifelse()` to create a variable called `flag` that is 1 if the average sales price is larger than the median sales price.

<font color="#ec008b">**If/then logic**</font>

`ifelse()` is an important tool in combination with `mutate()`. It employs f-then logic: the first argument is a binary statement. The second statement says what to do if the first argument is evaluated to `TRUE`- the third is what to do if it is false. This is particularly useful for creating dummy or indicator variables.
When you have more than two possible outcomes, it is more efficient to use `case_when()`.

<font color="#55b748">**Step 3a:**</font> Type `?case_when` into the console.

<font color="#55b748">**Step 4:**</font> Type the following code into your script.

```
txhousing %>% 
  group_by(year) %>% 
  summarize(yearly_sales = sum(sales))
```

<font color="#55b748">**Step 5:**</font> Sort the results of the previous code in order from most to least sales by adding ` %>% arrange(desc(yearly_sales))` to the end of the code.


# Exercise 3
<font color="#55b748">**Step 1:**</font>
<font color="#55b748">**Step 2:**</font>
<font color="#55b748">**Step 3:**</font>
<font color="#55b748">**Step 4:**</font>
<font color="#55b748">**Step 5:**</font>
group by and summarize

# Exercise 4
<font color="#55b748">**Step 1:**</font>
<font color="#55b748">**Step 2:**</font>
<font color="#55b748">**Step 3:**</font>
<font color="#55b748">**Step 4:**</font>
<font color="#55b748">**Step 5:**</font>
if else and case when



# Resources

* [Urban Institute R Users Group website](https://ui-research.github.io/r-at-urban/graphics-guide.html)
* [Why the Urban Institute visualizes data with ggplot2](https://medium.com/@urban_institute/why-the-urban-institute-visualizes-data-with-ggplot2-46d8cfc7ee67)
* [R for Data Science: data visualization](http://r4ds.had.co.nz/data-visualisation.html)
* [awunderground themes](https://awunderground.github.io/ggplot2-themes/)
* [R Graph Gallery](https://www.r-graph-gallery.com/)
